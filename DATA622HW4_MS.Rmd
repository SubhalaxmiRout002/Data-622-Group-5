---
title: "DATA 622 HW4"
author: "Magnus Skonberg"
date: "4/21/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

#libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(inspectdf)
library(corrplot)
```

## Authorship

**Group 5:** 

* Don (Geeth) Padmaperuma,
* Subhalaxmi Rout, 
* Isabel R., and
* Magnus Skonberg


# Background

The purpose of this assignment was to explore Clustering, Principal Component Analysis, and Support Vector Modeling.


## Our Approach

[Insert text]


................................................................................

## The Data

The dataset is an ADHD mental health datset from a real-life research project.

We load in the data and utilize built-in head() and dim() functions for an early read on the data at hand.

```{r}
#Load in data
data <- read.csv("https://raw.githubusercontent.com/SubhalaxmiRout002/Data-622-Group-5/main/HW%204/ADHD_data.csv")

#head(data)
#dim(data)
```


## Exploratory Data Analysis

From our initial read of our dataset's dimensions and first 6 entries, we see that we're dealing with a 175 observation x 54 variable dataset. Our initial dataset is broad and may be difficult to manage / make sense of. With the motivation of clarification in mind, we thus break our larger dataset into subsets:

1. **genl**: all identifier variables (race, sex, education), total score variables, and history-related variables.
2. **adhd**: all adhd related question and total score variables.
3. **md**: all mental disorder related question and total score variables.
4. **sub**: all substance abuse related question and total score variables.
5. **hstry**: all violence, abuse, and substance history related variables.

We may end up merging these subsets, pulling individual variables, or exploring individual subsets later but this provides a means of effectively recognizing where related variables lie while simultaneously providing smaller, more manageable dataframes to explore and work upon.

Once these dataframes are created, we see that **adhd** and **md** have total score variables whereas **sub** does not, even though its data (across variables) maintains a consistent scoring system. Thus, we take it upon ourselves to add this variable for sake of consistency:

```{r}

genl <- data[c(1:4,23,39)]
#head(genl) #drop initial, add sub and hstry (all vars or "total score")

#we may want to use these separately (ie. for Q2)
adhd <- data[c(5:23)]
md <- data[c(24:39)]
sub <- data[c(40:45)]
hstry <- data[c(46:54)]

sub$SUB.Total <- rowSums(sub) #add Total column to sub

#Finalize genl dataframe (for EDA)
genl$SUB.Total <- sub$SUB.Total #add SUB.Total to genl
genl <- genl[c(-1)] #drop Initial
genl <- cbind(genl, hstry) #add history variables back in with general
head(genl)

```

We subset our dataframes (as noted above), add a "total" column for **sub**, and finalize our **genl** dataframe by merging the total column for **sub**, dropping the `Initial` variable, and adding all **hstry** variables back in.

We lean on the data dictionary (provided with our .xlsx file) to outline the variables at hand:

* `Age`: quantitative variable representative of the individual's age.
* `Sex`: categorical variable representative of the individual's sex (male-1, female-2).
* `Race`: categorical variable representative of the individual's race (white-1, african american-2, hispanic-3, asian-4, native american-5, other / missing data-6).
* `ADHD.Total`: quantitative variable representative of the individual's total self-report score for ADHD scale. It's the cumulative score for 18 questions with a scoring metric of never-0, rarely-1, sometimes-2, often-3, and very often-4.
* `MD.TOTAL`: quantitative variable representative of the individual's total self-report score for mental disorder questions. It's the cumulative score for 15 questions with a scoring metric of no-0, yes-1; question 3: no problem-0, minor-1, moderate-2, and serious-3.
* `SUB.Total`: quantitative variable representative of the individual's total self-report score for substance abuse related questions. It's the cumulative score across 6 categories with a scoring metric of no use-0, use-1, abuse-2, and dependence-3.
* `Court.order`: categorical variable representative of whether the individual's case was court ordered (No-0, Yes-1).
* `Education`: categorical variable representative of the individual's level of education (1-12 grade, 13+ college).
* `Hx.of.Violence`: categorical variable representative of whether the individual has a history of violence (No-0, Yes-1).
* `Disorderly.Conduct`: categorical variable representative of whether the individual has a record of disorderly conduct (No-0, Yes-1).
* `Suicide`: categorical variable representative of whether the individual has attempted suicide in the past (No-0, Yes-1).
* `Abuse`: categorical variable representative of whether the individual has a history of abuse (No-0, Physical (P)-1, Sexual (S)-2, Emotional (E)-3, P&S-4, P&E-5, S&E-6, P&S&E-7).
* `Non.subst.Dx`: categorical variable representative of whether the individual has a non-substance diagonosis (0 – none; 1 – one; 2 – More than one).
* `Subst.Dx`: categorical variable representative of whether the individual has a substance diagonosis (0 – none; 1 – one Substance-related; 2 – two; 3 – three or more).
* `Psych.meds.`: categorical variable representative of whether the individual has been prescribed psychiatric medication (0 – none; 1 – one psychotropic med; 2 – more than one psychotropic med).

The resulting dataframe (and variables) are shown above and at this point we're prepared to more deeply explore our **genl** dataset.

To do so, we utilize the built-in summary() and glimpse() functions:

```{r}
summary(genl)
glimpse(genl)
```

From the above outputs we can extend that:

* the average `Age` of respondents is ~40, there are slightly more male than female respondents, and the average education level ~12 (finishing high school).
* the average `ADHD,Total` was ~34, the average `MD.TOTAL` was ~10, and the averge `SUB.Total` was ~4.
* `Disorderly.Conduct` appears to be more common than `Hx.of.Violence` which in turn is more common than `Court.order`.
* approximately 1/3 of respondents have attempted `Suicide` and some form of abuse appears to be common (ie. Physical).
* the average `Non.subst.Dx`  was ~0.4 while the average `Subst.Dx` was ~1.1 giving the impression that we're dealing with more substance diagnoses that non-substance diagnoses.
* `Psych.meds` is missing the majority of its values and NA values will have to be accounted for (in general).

Based on this information, we drop `Psych.meds`, drop remaining NA values, and observe the affect on our dataset:

```{r}
genl <- genl[c(-15)] #drop Psych.meds
genl <- genl %>% tibble() %>% drop_na() #drop NA values

#revisit genl
dim(genl) #175 - 142 = 33 dropped rows
colSums(is.na(genl)) #verify no NAs

```

Our dataset has been reduced from 175 observations x 15 variables to 142 observations x 14 variables and from numerous NA values across multiple variables to no NA values.

With NA values dealt with, we ensure each variable's of the proper type and then visualize our variable distributions based on whether they're categorical or numeric: 

```{r}
#convert features to factor
genl$Sex <- as.factor(genl$Sex)
genl$Race <- as.factor(genl$Race)
genl$Court.order <- as.factor(genl$Court.order)
genl$Education <- as.factor(genl$Education)
genl$Hx.of.Violence <- as.factor(genl$Hx.of.Violence)
genl$Disorderly.Conduct <- as.factor(genl$Disorderly.Conduct)
genl$Suicide <- as.factor(genl$Suicide)
genl$Abuse <- as.factor(genl$Abuse)
genl$Non.subst.Dx <- as.factor(genl$Non.subst.Dx)
genl$Subst.Dx <- as.factor(genl$Subst.Dx)

#conver features to numeric
genl$Age <- as.numeric(genl$Age)
genl$ADHD.Total <- as.numeric(genl$ADHD.Total)
genl$MD.TOTAL <- as.numeric(genl$MD.TOTAL)
genl$SUB.Total <- as.numeric(genl$SUB.Total)

#head(genl) #verify conversions

#visualize categorical distributions as a table
fig1 <- inspectdf::inspect_imb(genl)
fig1

```

From the table above we see that ~92% of respondent's cases were not court ordered, ~74% of respondents do not have a history of violence, ~70% of respondents have a history of disorderly conduct, ~68% of respondents have not attempted suicide, ~65% of respondents do not have a non-substance diagnosis, ~63% of respondents do not have a history of abuse, ~56% of respondents are African American, ~54% of respondents are male, ~39% of respondents have completed *at least* high school, and ~39% of respondents have one substance related diagnosis. *The fact that `Education` and `Subst.Dx` have the same pcnt values is interesting and worth noting.*

Moving on to our numeric distributions:
```{r}
#visualize numeric distributions 
fig2 <- inspectdf::inspect_num(genl) %>% 
    show_plot()
fig2

```

From the histograms above we see that:

* `ADHD.Total` has a left skewed normal distribution with a peak ~45.
* `Age` appears to be bimodal with peaks ~25 and ~50.
* `MD.TOTAL` has a non-normal distribution with a peak concentrated > 15 (at the far right).
* `SUB.Total` appears to have a multi-modal distribution with its largest peak at ~3.

With insight gained via variable distributions, we move on to observing the pair plot and correlation matrix for numeric variables:

```{r}
#paired plot of numeric variables
pairs(genl %>% select_if(is.numeric))

#Correlation matrix for numeric variables
genl_corr <- genl %>%
    select_if(is.numeric) %>%
    cor()

corrplot(genl_corr, title="Numeric Variable Correlation",type = "lower", mar=c(0,0,1,0))

```

The pair plot and correlation matrix highlight the fact that `ADHD.Total` and `MD.TOTAL` appear to have strong correlation. We'll note this fact, while carrying both variables forward.


................................................................................

# 1. Clustering

Transition write up

```{r}

```



